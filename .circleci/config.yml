version: 2.1
jobs:
  build:
    machine:
      image: ubuntu-1604:202004-01
    working_directory: ~/movie-api
    steps:
      - checkout

      - run:
          name : Build Docker Image
          command: docker build -t movie-api:$CIRCLE_SHA1 .
      - run:
          name: Deploy to Heroku
          command: |
            docker login --username=_ --password=$HEROKU_API_KEY registry.heroku.com
            docker tag movie-api:$CIRCLE_SHA1 registry.heroku.com/$HEROKU_APP_NAME/web
            docker push registry.heroku.com/$HEROKU_APP_NAME/web
